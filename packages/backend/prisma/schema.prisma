// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
}

model SimulationParameter {
  id                           Int                @id @default(autoincrement())
  chargepoints                 Chargepoint[]
  consumptionKwhPer100km       Float
  days                         Int
  intervalMinutes              Int
  arrivalProbabilityMultiplier Int // Stored as percentage (20-200)
  simulationResults            SimulationResult[]
  createdAt                    DateTime           @default(now())
  updatedAt                    DateTime           @updatedAt
}

model Chargepoint {
  id                    Int                 @id @default(autoincrement())
  simulationParameter   SimulationParameter @relation(fields: [simulationParameterId], references: [id], onDelete: Cascade)
  simulationParameterId Int
  powerKw               Float
  count                 Int
}

model SimulationResult {
  id                       Int                       @id @default(autoincrement())
  simulationParameter      SimulationParameter?      @relation(fields: [simulationParameterId], references: [id], onDelete: Cascade)
  simulationParameterId    Int?
  totalEnergyKwh           Float
  maxPowerKw               Float
  maxTheoreticalPowerKw    Float
  concurrencyFactor        Float
  aggregatedDailyData      AggregatedDailyData?
  powerHistogramDataPoints PowerHistogramDataPoint[]
  chargepointUtilizations  ChargepointUtilization[]
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
}

model ChargepointUtilization {
  id                  Int              @id @default(autoincrement())
  simulationResult    SimulationResult @relation(fields: [simulationResultId], references: [id], onDelete: Cascade)
  simulationResultId  Int
  powerKw             Float
  utilization         Float
  avgDailyEvents      Float
  avgDailyEnergyKwh   Float
  avgMonthlyEvents    Float
  avgMonthlyEnergyKwh Float
}

model AggregatedDailyData {
  id                 Int                 @id @default(autoincrement())
  simulationResult   SimulationResult    @relation(fields: [simulationResultId], references: [id], onDelete: Cascade)
  simulationResultId Int                 @unique
  totalIntervals     Int
  intervalMinutes    Int
  dailyStats         DailyStats?
  intervalDataPoints IntervalDataPoint[]
}

model DailyStats {
  id                    Int                 @id @default(autoincrement())
  aggregatedDailyData   AggregatedDailyData @relation(fields: [aggregatedDailyDataId], references: [id], onDelete: Cascade)
  aggregatedDailyDataId Int                 @unique
  avg                   Float
  max                   Float
  min                   Float
}

model IntervalDataPoint {
  id                    Int                 @id @default(autoincrement())
  aggregatedDailyData   AggregatedDailyData @relation(fields: [aggregatedDailyDataId], references: [id], onDelete: Cascade)
  aggregatedDailyDataId Int
  interval              Int
  time                  DateTime
  avg                   Float
  max                   Float
  min                   Float
}

model PowerHistogramDataPoint {
  id                 Int              @id @default(autoincrement())
  simulationResult   SimulationResult @relation(fields: [simulationResultId], references: [id], onDelete: Cascade)
  simulationResultId Int
  maxPowerKw         Float
  count              Int
  percentage         Float
}
